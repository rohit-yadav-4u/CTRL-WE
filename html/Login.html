<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login / Signup</title>
  <link rel="stylesheet" href="../css/login.css" />
</head>
<body>
  <div class="login-container">
    <h2 id="form-title">Login</h2>
    <form id="auth-form">
      <input type="text" id="name" placeholder="Name" style="display:none;" autocomplete="name" />
      <input type="email" id="email" placeholder="Email" required autocomplete="email" />
      <input type="password" id="password" placeholder="Password" required autocomplete="current-password" />
      <button type="submit" id="auth-button">Login</button>
      <p class="toggle-link" id="toggle-form">Don't have an account? Sign Up</p>
      <p id="auth-error" class="error"></p>
    </form>
  </div>

  <script type="module" src="../js/login.js"></script>
  <script>
    // Dynamically load navbar.html into #navbar-container and inject its CSS/JS
    document.addEventListener("DOMContentLoaded", function () {
      fetch("../html/navbar.html")
        .then((response) => response.text())
        .then((html) => {
          const tempDiv = document.createElement("div");
          tempDiv.innerHTML = html;
          // Inject all <link rel="stylesheet"> to <head>
          tempDiv
            .querySelectorAll('link[rel="stylesheet"]')
            .forEach((link) => {
              if (
                !document.head.querySelector(
                  `link[href="${link.getAttribute("href")}"]`
                )
              ) {
                document.head.appendChild(link.cloneNode());
              }
            });
          // Insert navbar HTML first
          const navbarHtml = Array.from(tempDiv.children)
            .filter(
              (el) =>
                el.tagName !== "SCRIPT" &&
                el.tagName !== "LINK" &&
                el.tagName !== "HEAD"
            )
            .map((el) => el.outerHTML)
            .join("");
          const navbarContainer = document.getElementById("navbar-container");
          navbarContainer.innerHTML = navbarHtml;
          navbarContainer.style.display = "block";
          // Now inject all <script src> to <body> (after navbar is present)
          tempDiv.querySelectorAll("script[src]").forEach((script) => {
            if (
              !document.body.querySelector(
                `script[src="${script.getAttribute("src")}"]`
              )
            ) {
              const s = document.createElement("script");
              s.src = script.getAttribute("src");
              s.async = false;
              document.body.appendChild(s);
            }
          });
          // Inline scripts: execute them after navbar is present
          tempDiv.querySelectorAll("script:not([src])").forEach((script) => {
            try {
              eval(script.textContent);
            } catch (e) {}
          });
          // Now load navbar.js after navbar is ready
          var navbarJs = document.createElement("script");
          navbarJs.src = "../js/navbar.js";
          navbarJs.type = "module";
          navbarJs.async = false;
          document.body.appendChild(navbarJs);
        });
    });
  </script>
</body>
</html>
