<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart Animation Demo</title>
    <link rel="stylesheet" href="../css/shop.css" />
    <link rel="stylesheet" href="../css/navbar.css" />

    <!-- Navbar CSS links will be injected dynamically -->
  </head>

  <body>
    <!-- Navbar will be loaded here, hidden by default -->
    <div id="navbar-container" style="display: none"></div>
    <!-- Main content wrapper to avoid navbar overlap -->
    <div id="main-content">
      <header class="main-header">
        <!--<div class="header-content">
        <span class="main-title">Classic Collection</span>
      </div>-->
        <div class="header-description">
          <h1 class="header-heading">Artisan Collection</h1>
          <p class="header-subheading">
            Discover our handcrafted treasures from across India
          </p>
        </div>
        <div>
          <button class="cart-toggle-btn" aria-label="Open cart">
            ðŸ›’<span class="cart-count">0</span>
          </button>
        </div>
      </header>
      <div class="shop-container">
        <div class="cart-panel cart-dropdown" style="display: none">
          <div class="cart-header">
            <span>ðŸ›’ Cart</span>
            <span class="cart-count">0</span>
            <button class="cart-close-btn" aria-label="Close cart">âœ•</button>
          </div>
          <div class="cart-items"></div>
          <div class="cart-footer">
            <div>Total: â‚¹<span class="cart-total">0.00</span></div>
            <button class="checkout-btn">Checkout</button>
          </div>
        </div>
        <div class="shop-list"></div>
      </div>
      <!-- Effect Panel for image transition (hidden by default) -->
      <div
        class="effect-panel shop-panel"
        style="pointer-events: none; opacity: 0"
      >
        <div class="shop-panel-img"></div>
      <div class="shop-panel-info">
        <h2></h2>
        <div class="shop-panel-price"></div>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
          Pellentesque euismod, nisi eu consectetur.
        </p>
        <ul>
          <li>Feature 1</li>
          <li>Feature 2</li>
          <li>Feature 3</li>
        </ul>
        <button class="shop-panel-buy add-to-cart">Add to cart</button>
      </div>
      <button class="effect-panel-close">Close</button>
      </div>
      <div class="subscribe-section">
        <p class="subscribe-heading">
          Subscribe to get Updated with new offers
        </p>
        <div class="subscribe-form">
          <input
            type="email"
            placeholder="Enter Email Address"
            class="subscribe-input"
          />
          <button class="subscribe-btn">SUBSCRIBE NOW</button>
        </div>
        <p class="subscribe-count">1,234 people subscribed</p>
      </div>
    </div>
    
    <!-- Checkout Modal Popup -->
    <div id="checkout-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Checkout</h2>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <div class="order-summary">
            <h3>Order Summary</h3>
            <div id="order-items"></div>
            <div class="order-total">
              <strong>Pay on Delivery: â‚¹<span id="order-total">0.00</span></strong>
            </div>
          </div>
          <div class="customer-info">
            <h3>Customer Information</h3>
            <form id="checkout-form">
              <div class="form-group">
                <label for="customer-name">Full Name:</label>
                <input type="text" id="customer-name" name="name" required>
              </div>
              <div class="form-group">
                <label for="customer-address">Address:</label>
                <textarea id="customer-address" name="address" rows="3" required></textarea>
              </div>
              <div class="form-group">
                <label for="customer-phone">Phone Number:</label>
                <input type="tel" id="customer-phone" name="phone" required>
              </div>
            </form>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancel-checkout" class="btn-secondary">Cancel</button>
          <button id="confirm-checkout" class="btn-primary">Place Order</button>
        </div>
      </div>
    </div>
    
    <script src="../js/gsap.min.js"></script>
    <script>
      // Dynamically load navbar.html into #navbar-container and inject its CSS/JS
      document.addEventListener("DOMContentLoaded", function () {
        fetch("../html/navbar.html")
          .then((response) => response.text())
          .then((html) => {
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = html;
            // Inject all <link rel="stylesheet"> to <head>
            tempDiv
              .querySelectorAll('link[rel="stylesheet"]')
              .forEach((link) => {
                if (
                  !document.head.querySelector(
                    `link[href="${link.getAttribute("href")}"]`
                  )
                ) {
                  document.head.appendChild(link.cloneNode());
                }
              });
            // Insert navbar HTML first
            const navbarHtml = Array.from(tempDiv.children)
              .filter(
                (el) =>
                  el.tagName !== "SCRIPT" &&
                  el.tagName !== "LINK" &&
                  el.tagName !== "HEAD"
              )
              .map((el) => el.outerHTML)
              .join("");
            const navbarContainer = document.getElementById("navbar-container");
            navbarContainer.innerHTML = navbarHtml;
            navbarContainer.style.display = "block"; // Show instantly, no effects
            //var mainNavbar = document.getElementById('main-navbar');
            //if (mainNavbar) mainNavbar.style.width = '96%';-->
            // Now inject all <script src> to <body> (after navbar is present)
            tempDiv.querySelectorAll("script[src]").forEach((script) => {
              if (
                !document.body.querySelector(
                  `script[src="${script.getAttribute("src")}"]`
                )
              ) {
                const s = document.createElement("script");
                s.src = script.getAttribute("src");
                s.async = false;
                s.onload = function () {
                  if (s.src.includes("navbar.js")) {
                    if (window.attachUnifiedSearchLogic) {
                      window.attachUnifiedSearchLogic();
                    }
                  }
                };
                document.body.appendChild(s);
              }
            });
            // Inline scripts: execute them after navbar is present
            tempDiv.querySelectorAll("script:not([src])").forEach((script) => {
              try {
                eval(script.textContent);
              } catch (e) {}
            });
            // Now load shop-loader.js and shop.js after navbar is ready
            var shopLoader = document.createElement("script");
            shopLoader.src = "../js/shop-loader.js";
            shopLoader.async = false;
            document.body.appendChild(shopLoader);
            var shopJs = document.createElement("script");
            shopJs.src = "../js/shop.js";
            shopJs.async = false;
            document.body.appendChild(shopJs);
          });
      });
    </script>
  </body>
</html>
